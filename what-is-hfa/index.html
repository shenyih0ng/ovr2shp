<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/ovr2shp/rss.xml" title="ovr2shp Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ovr2shp/atom.xml" title="ovr2shp Blog Atom Feed"><title data-react-helmet="true">Parsing .ovr | ovr2shp</title><meta data-react-helmet="true" property="og:title" content="Parsing .ovr | ovr2shp"><meta data-react-helmet="true" name="description" content="Hierarchical File Architecture(HFA) is Hexagon Geospatial&#x27;s proprietary file format. It is the file format behind ERDAS Imagine .img files and ERDAS Imagine Annotation Layer .ovr files. It is not exactly the most &quot;open&quot; file standard out there, but luckily GDAL implements a raster driver for.img files, which offers an glimpse into the internals of HFA."><meta data-react-helmet="true" property="og:description" content="Hierarchical File Architecture(HFA) is Hexagon Geospatial&#x27;s proprietary file format. It is the file format behind ERDAS Imagine .img files and ERDAS Imagine Annotation Layer .ovr files. It is not exactly the most &quot;open&quot; file standard out there, but luckily GDAL implements a raster driver for.img files, which offers an glimpse into the internals of HFA."><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/ovr2shp/img/logo.svg"><link rel="stylesheet" href="/ovr2shp/styles.a1e291b4.css">
<link rel="stylesheet" href="/ovr2shp/main.c60dcc57.css">
<link rel="preload" href="/ovr2shp/styles.a91e4a20.js" as="script">
<link rel="preload" href="/ovr2shp/runtime~main.9ced793b.js" as="script">
<link rel="preload" href="/ovr2shp/main.f6bbc879.js" as="script">
<link rel="preload" href="/ovr2shp/common.38a3b6c3.js" as="script">
<link rel="preload" href="/ovr2shp/ccc49370.eac0d914.js" as="script">
<link rel="preload" href="/ovr2shp/a5ba5aae.53ab610b.js" as="script">
<link rel="preload" href="/ovr2shp/f3730adf.f994a252.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/ovr2shp/"><img src="/ovr2shp/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/ovr2shp/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">ovr2shp</strong></a><a class="navbar__item navbar__link" href="/ovr2shp/docs">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ovr2shp/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shenyih0ng/ovr2shp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/ovr2shp/"><img src="/ovr2shp/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/ovr2shp/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">ovr2shp</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/ovr2shp/docs">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/ovr2shp/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/shenyih0ng/ovr2shp" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub"></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a aria-current="page" class="sidebarItemLink_v5H9 sidebarItemLinkActive_1anX" href="/ovr2shp/what-is-hfa">Parsing .ovr</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_3-lP">Parsing .ovr</h1><div class="margin-vert--md"><time datetime="2021-02-22T14:49:17.326Z" class="blogPostDate_Ta7i">February 22, 2021  Â· 6 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/shenyih0ng" target="_blank" rel="noreferrer noopener">shenyihong</a></h4><small class="avatar__subtitle">Maintainer of ovr2shp</small></div></div></header><section class="markdown"><p>Hierarchical File Architecture(HFA) is <a href="https://www.hexagongeospatial.com/" target="_blank" rel="noopener noreferrer">Hexagon Geospatial&#x27;s</a> proprietary file format. It is the file format behind ERDAS Imagine <code>.img</code> files and ERDAS Imagine Annotation Layer <code>.ovr</code> files. It is not exactly the most &quot;open&quot; file standard out there, but luckily <a href="https://github.com/OSGeo/gdal" target="_blank" rel="noopener noreferrer">GDAL</a> implements a raster driver for<code>.img</code> files, which offers an glimpse into the internals of HFA. </p><p>Now that we know that a open-sourced driver that can parse a file with the HFA format exists, we can use that as our starting point.</p><blockquote><p>My Goal: <strong>Convert Erdas Imagine Annotation Layer(.ovr) to ShapeFile(.shp)</strong></p></blockquote><p>The problem, however, is that GDAL is bulky and I have limited experience dealing with big c++ projects. Since we would only need specific files to parse HFA compliant files, I went digging for something more lightweight. I managed to find a web archive page that contained a early version of a <code>.img</code> to <code>.tif</code> converter. You can find the page <a href="http://web.archive.org/web/20130730133056/http://home.gdal.org/projects/imagine/hfa_index.html" target="_blank" rel="noopener noreferrer">here</a>.</p><p>This page also turns out to be the holy grail as it also referenced a <a href="https://github.com/shenyih0ng/ovr2shp/blob/dev/docs/hfa.pdf" target="_blank" rel="noopener noreferrer">detailed documentation</a> of <code>.img</code> file format and the internals of HFA</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="img2tif"></a>img2tif<a class="hash-link" href="#img2tif" title="Direct link to heading">#</a></h2><p>The source code included drivers for HFA and GeoTIFF, but there is just one caveat: The HFA driver included is not a general implementation but rather one that is specifically made for <code>.img</code>. It is the same case for the HFA driver in GDAL. </p><p>Fortunately, it has all the low-level implementations included to parse raw bytes into a generic higher level HFA data classes.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">+---hfa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfa.h</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfaband.cpp         # class to represent a raster band in a .img</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfacompress.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfadictionary.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfaentry.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfafield.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfaopen.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfatype.cpp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       hfa_p.h</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>What&#x27;s left for me is to fill in the gaps by implementing high level representations of data types found in a <code>.ovr</code> HFA structure. With a few changes, I was able to integrate this driver to successfully parse a <code>.ovr</code> file.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="hierarchical-file-architecture-hfa"></a>Hierarchical File Architecture (HFA)<a class="hash-link" href="#hierarchical-file-architecture-hfa" title="Direct link to heading">#</a></h2><p>Hidden within the detailed documentation lies the secrets to HFA. </p><blockquote><p>The hierarchical file architecture maintains an objectâˆ’oriented representation of data in an ERDAS IMAGINE
disk file through use of a tree structure. Each object is called an entry and occupies one node in the tree. Each
object has a name and a type. The type refers to a description of the data contained by that object. Additionally
each object may contain a pointer to a subtree of more nodes.</p></blockquote><p><img alt="HFA File Structure" src="/ovr2shp/assets/images/hfastructure-39ee10b5cb1230b9081faba4e8fab110.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="header-tag"></a>Header Tag<a class="hash-link" href="#header-tag" title="Direct link to heading">#</a></h3><ul><li>dtype: <code>Ehfa_HeaderTag</code></li><li>size: <code>20b</code><ul><li>First <code>16b</code> contains the unique signature of a ERDAS IMAGE HFA File: <strong>EHFA_HEADER_TAG</strong></li><li>Remaining <code>4b</code> contains the file pointer to the header record</li></ul></li></ul><p><strong>The header tag does not correspond to the header node shown in the diagram above! This is just a tag that contains a reference to the header node</strong></p><blockquote><p>The value of a file pointer is simply the number of bytes from the start of the file</p></blockquote><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cpp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Referenced from HFA Driver */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Parsing the first 16 bytes to verify if it is a HFA file</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">VSIFReadL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> szHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">CPLError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> CE_Failure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CPLE_AppDefined</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Attempt to read 16 byte header failed for\n%s.&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      pszFilename </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">EQUALN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">szHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;EHFA_HEADER_TAG&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">CPLError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> CE_Failure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CPLE_AppDefined</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;File %s is not an Imagine HFA file ... header wrong.&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      pszFilename </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Parsing the subsequent 4 bytes to get header record/node</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">VSIFReadL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">nHeaderPos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">GInt32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">HFAStandard</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">nHeaderPos </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">VSIFSeekL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> fp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> nHeaderPos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">SEEK_SET</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="header-record"></a>Header Record<a class="hash-link" href="#header-record" title="Direct link to heading">#</a></h3><ul><li>dtype: <code>Ehfa_File</code></li><li>The header record contains file pointers to the <strong>Root node</strong> of the HFA Tree and the <strong>MIF (Machine Independent Format) Dictionary</strong>.<ul><li>MIF Dictionary stores all the type information for each kind of node in the HFA Tree.</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="mif-dictionary"></a>MIF Dictionary<a class="hash-link" href="#mif-dictionary" title="Direct link to heading">#</a></h3><ul><li>dtype: <code>char*</code></li><li>The MIF Dictionary contains different type information for different nodes in the HFA Tree. Hence, <strong>the dictionary must be read and decoded before any of the other objects in the file can be decoded</strong></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cpp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property"># Sample dtypes seen in MIF Dictionary</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">lversion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">LfreeList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">LrootEntryPtr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">sentryHeaderLength</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">LdictionaryPtr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Ehfa_File</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">Lnext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">Lprev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">Lparent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">Lchild</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">Ldata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">ldataSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">64</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">cname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">ctype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">tmodTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Ehfa_Entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">clabel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">LheaderPtr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Ehfa_HeaderTag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Type information is encoded like such: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cpp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">num_element</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">dtype_char</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">attr_name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">dtype_identifier</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><p><code>num_element</code>: Number of <code>dtype_char</code> element </p><ul><li>Example: To encode the Header Tag in the <code>Ehfa_HeaderTag</code> data type, each of the first <code>16b</code> has a <code>char</code> dtype occupying <code>1b</code> of space. To encode the entire tag 16 <code>char</code> is needed, hence <code>{16:clabel}</code></li></ul></li><li><p><code>dtype_char</code>: MIF data type identifier</p><p><img alt="MIF ItemType" src="/ovr2shp/assets/images/mif-736e263da9a70595be977e805350e79d.png"></p></li><li><p><code>attr_name</code>: Name of attribute under type</p></li><li><p><code>dtype_identifier</code>: data type of node</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="root-node"></a>Root Node<a class="hash-link" href="#root-node" title="Direct link to heading">#</a></h3><ul><li><p>dtype: <code>Ehfa_Entry</code></p></li><li><p>The root node is the entry point into the main HFA tree structure. By traversing down the tree from the root, data nodes (where the &quot;gold&quot; is at) can extracted</p></li><li><p>A <code>Ehfa_Entry</code> dtype contains file pointers to the <em>next node</em> and <em>child node</em>. We use these pointers to traverse down the HFA Tree.</p><ul><li><strong>Next Node</strong>: The node &quot;right&quot; of the current node on the same level</li><li><strong>Child Node</strong>: &quot;Left-Most&quot; child node</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ehfa_entry"></a>Ehfa_Entry<a class="hash-link" href="#ehfa_entry" title="Direct link to heading">#</a></h3><p><code>Ehfa_Entry</code> is data type representing the nodes of the HFA tree structure. A single <code>Ehfa_Entry</code> contains &quot;tree&quot; level attributes (file ptr to child node, name of node etc.) and  a file pointer reference to the data block.</p><p>To be put it simply, there are 2 different sections to a <code>Ehfa_Entry</code></p><p>To dive deeper into the 2 sections, let&#x27;s look at the type definition of <code>Ehfa_Entry</code> found in the <strong>MIF Dictionary</strong></p><p><code>{1:Lnext,1:Lprev,1:Lparent,1:Lchild,1:Ldata,1:ldataSize,64:cname,32:ctype,1:tmodTime,}Ehfa_Entry,</code></p><ul><li><p><strong>Base section</strong></p><ul><li>Tree level attributes/metadata (attributes in the type definition above are all tree level attributes)	<blockquote><p>Tree level attributes can be interpreted as meta attributes that allow traversal of the tree structure without ever requiring to touch the data residing in it</p></blockquote></li></ul></li><li><p><strong>Data section</strong></p><ul><li>Data within the node (annotation name, coordinates etc.)</li><li>The data block can be accessed using the file pointer value found in the <code>data</code> attribute<blockquote><p><code>{1:Ldata}</code> contains the file pointer to the data node </p></blockquote></li><li>The data that resides in the node has a corresponding data type that can be found in the <strong>MIF Dictionary</strong>. The data type is identifiable by the <code>type</code> attribute seen above.<blockquote><p><code>{32:ctype}</code> contains the data type identifier</p></blockquote></li></ul></li></ul><p><strong>In order to extract the data we are interested in, we will seek the specified file position in the <code>data</code> attribute and parse the bytes into the higher level data structure specified in <code>type</code> attr.</strong></p><p>The following are examples of data type identifiers that can be found in a  <code>Ehfa_Entry</code>:</p><ul><li><p><code>Rectangle2</code>: Contains geometric definitions of ERDAS Rectangle Annotations</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cpp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">Lflags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">lfillStyle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">oEevg_Coord</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">center</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">dwidth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">dheight</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">dorientation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Rectangle2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p><code>Eprj_MapInfo</code>: Contains image map coordinates</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cpp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">pcproName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">oEprj_Coordinate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">upperLeftCenter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">oEprj_Coordinate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">lowerRightCenter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">oEprj_Size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">pixelSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">pcunits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Eprj_MapInfo</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p><code>Eprj_ProParameters</code>: Contains projection parameters</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cpp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">e2</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">EPRJ_INTERNAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">EPRJ_EXTERNAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">proType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">lproNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">pcproExeName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">pcproName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">lproZone</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">pdproParams</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">oEprj_Spheroid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">proSpheroid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Eprj_ProParameters</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p><code>Eprj_Datum</code>: Contains datum information</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cpp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">pcdatumname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">e3</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">EPRJ_DATUM_PARAMETRIC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">EPRJ_DATUM_GRID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">EPRJ_DATUM_REGRESSION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">pdparams</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">pcgridname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Eprj_Datum</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li></ul></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/ovr2shp/tags/hfa">hfa</a><a class="margin-horiz--sm" href="/ovr2shp/tags/ovr">ovr</a></div></footer></article><div><a href="https://github.com/shenyih0ng/ovr2shp/tree/gh-pages/blog/what-is-hfa.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#img2tif" class="table-of-contents__link">img2tif</a></li><li><a href="#hierarchical-file-architecture-hfa" class="table-of-contents__link">Hierarchical File Architecture (HFA)</a><ul><li><a href="#header-tag" class="table-of-contents__link">Header Tag</a></li><li><a href="#header-record" class="table-of-contents__link">Header Record</a></li><li><a href="#mif-dictionary" class="table-of-contents__link">MIF Dictionary</a></li><li><a href="#root-node" class="table-of-contents__link">Root Node</a></li><li><a href="#ehfa_entry" class="table-of-contents__link">Ehfa_Entry</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/shenyih0ng/ovr2shp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/ovr2shp/styles.a91e4a20.js"></script>
<script src="/ovr2shp/runtime~main.9ced793b.js"></script>
<script src="/ovr2shp/main.f6bbc879.js"></script>
<script src="/ovr2shp/common.38a3b6c3.js"></script>
<script src="/ovr2shp/ccc49370.eac0d914.js"></script>
<script src="/ovr2shp/a5ba5aae.53ab610b.js"></script>
<script src="/ovr2shp/f3730adf.f994a252.js"></script>
</body>
</html>